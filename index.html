<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Signature System + Web3Forms Email</title>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body { font-family: Arial; background:#f5f5f5; text-align:center; margin:0; padding:20px; }
    #signature-box { width:100%; height:60vh; background:white; border:2px solid black; overflow:hidden; }
    canvas { width:100%; height:100%; touch-action:none; }
    button { padding:12px 22px; margin:10px; border:none; background:#333; color:white; border-radius:8px; }
    #save { background:#0a8f08; }
    #clear { background:#d32f2f; }
</style>
</head>

<body>

<h2>Digital Signature â€” Web3Forms Mail</h2>

<input id="username" type="text" placeholder="Enter Your Name" 
style="width:90%;padding:12px;border:1px solid #777;border-radius:8px;margin-bottom:10px;">

<input id="emailid" type="email" placeholder="Enter Email to Receive PDF" 
style="width:90%;padding:12px;border:1px solid #777;border-radius:8px;margin-bottom:20px;">

<div id="signature-box">
    <canvas id="canvas"></canvas>
</div>

<button id="clear">Clear</button>
<button id="save">Save & Send Mail</button>

<!-- Hidden Web3Forms send form -->
<form id="sendForm" action="https://api.web3forms.com/submit" method="POST" style="display:none;">
    <input type="hidden" name="access_key" value="da58c48c-c03a-4753-864c-3c121fb9cf1b">
    <input type="hidden" name="subject" value="New Signature PDF Submitted">
    <input type="hidden" name="name" id="form_name">
    <input type="hidden" name="email" id="form_email">
    <input type="hidden" name="pdf_data" id="form_pdf">
</form>

<script>
/* ---------------- Canvas Setup ---------------- */
const canvas = document.getElementById("canvas");
const box = document.getElementById("signature-box");

function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = box.clientWidth * ratio;
    canvas.height = box.clientHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
}
resizeCanvas();
window.onresize = resizeCanvas;

let signaturePad = new SignaturePad(canvas, {
    backgroundColor: "white",
    penColor: "blue",
    minWidth: 1.6,
    maxWidth: 3.4
});

/* ---------------- Clear Button ---------------- */
document.getElementById("clear").onclick = () => signaturePad.clear();

/* ---------------- Save + Send Mail ---------------- */
document.getElementById("save").onclick = async () => {

    const name = document.getElementById("username").value.trim();
    const email = document.getElementById("emailid").value.trim();

    if (!name) return alert("Enter your name");
    if (!email) return alert("Enter email");
    if (signaturePad.isEmpty()) return alert("Please sign first!");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("landscape", "pt", "a4");

    // Auto matter
    pdf.setFontSize(18);
    pdf.text(`I am the ${name}`, 40, 40);

    // Signature image
    const imgData = signaturePad.toDataURL("image/png");
    pdf.addImage(imgData, "PNG", 40, 80, 760, 450);

    // Convert to Base64
    const pdfBase64 = pdf.output("datauristring");

    // Attach to form
    document.getElementById("form_name").value = name;
    document.getElementById("form_email").value = email;
    document.getElementById("form_pdf").value = pdfBase64;

    // Submit form to Web3Forms
    document.getElementById("sendForm").submit();

    alert("PDF sent to your Email Successfully!");
};
</script>

</body>
</html>